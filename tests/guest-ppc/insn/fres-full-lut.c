/*
 * libbinrec: a recompiling translator for machine code
 * Copyright (c) 2016 Andrew Church <achurch@achurch.org>
 *
 * This software may be copied and redistributed under certain conditions;
 * see the file "COPYING" in the source code distribution for details.
 * NO WARRANTY is provided with this software.
 */

#include "tests/guest-ppc/insn/common.h"

static const uint8_t input[] = {
    0xEC,0x20,0x10,0x30,  // fres f1,f2
};

static const unsigned int guest_opt = 0;
static const unsigned int common_opt = 0;

static const bool expected_success = true;

static const char expected[] =
    "[info] Scanning terminated at requested limit 0x3\n"
    "    0: LOAD_ARG   r1, 0\n"
    "    1: LOAD_ARG   r2, 1\n"
    "    2: GET_ALIAS  r3, a3\n"
    "    3: FCAST      r4, r3\n"
    "    4: GET_ALIAS  r5, a4\n"
    "    5: BITCAST    r6, r4\n"
    "    6: ANDI       r7, r6, -2147483648\n"
    "    7: BFEXT      r8, r6, 0, 23\n"
    "    8: SET_ALIAS  a7, r8\n"
    "    9: BFEXT      r9, r6, 23, 8\n"
    "   10: SET_ALIAS  a6, r9\n"
    "   11: GOTO_IF_Z  r9, L4\n"
    "   12: SEQI       r10, r9, 255\n"
    "   13: GOTO_IF_NZ r10, L5\n"
    "   14: GOTO       L6\n"
    "   15: LABEL      L5\n"
    "   16: GOTO_IF_NZ r8, L7\n"
    "   17: BITCAST    r11, r7\n"
    "   18: SET_ALIAS  a5, r11\n"
    "   19: LOAD_IMM   r12, 2\n"
    "   20: LOAD_IMM   r13, 18\n"
    "   21: SELECT     r14, r13, r12, r7\n"
    "   22: GET_ALIAS  r15, a4\n"
    "   23: BFINS      r16, r15, r14, 12, 7\n"
    "   24: SET_ALIAS  a4, r16\n"
    "   25: GOTO       L2\n"
    "   26: LABEL      L7\n"
    "   27: ANDI       r17, r8, 4194304\n"
    "   28: GOTO_IF_Z  r17, L8\n"
    "   29: SET_ALIAS  a5, r4\n"
    "   30: LOAD_IMM   r18, 17\n"
    "   31: GET_ALIAS  r19, a4\n"
    "   32: BFINS      r20, r19, r18, 12, 7\n"
    "   33: SET_ALIAS  a4, r20\n"
    "   34: GOTO       L2\n"
    "   35: LABEL      L8\n"
    "   36: GET_ALIAS  r21, a4\n"
    "   37: NOT        r22, r21\n"
    "   38: ORI        r23, r21, 16777216\n"
    "   39: ANDI       r24, r22, 16777216\n"
    "   40: SET_ALIAS  a4, r23\n"
    "   41: GOTO_IF_Z  r24, L9\n"
    "   42: ORI        r25, r23, -2147483648\n"
    "   43: SET_ALIAS  a4, r25\n"
    "   44: LABEL      L9\n"
    "   45: ANDI       r26, r5, 128\n"
    "   46: GOTO_IF_NZ r26, L3\n"
    "   47: ORI        r27, r6, 4194304\n"
    "   48: BITCAST    r28, r27\n"
    "   49: SET_ALIAS  a5, r28\n"
    "   50: LOAD_IMM   r29, 17\n"
    "   51: GET_ALIAS  r30, a4\n"
    "   52: BFINS      r31, r30, r29, 12, 7\n"
    "   53: SET_ALIAS  a4, r31\n"
    "   54: GOTO       L2\n"
    "   55: LABEL      L4\n"
    "   56: GOTO_IF_NZ r8, L10\n"
    "   57: GET_ALIAS  r32, a4\n"
    "   58: NOT        r33, r32\n"
    "   59: ORI        r34, r32, 67108864\n"
    "   60: ANDI       r35, r33, 67108864\n"
    "   61: SET_ALIAS  a4, r34\n"
    "   62: GOTO_IF_Z  r35, L11\n"
    "   63: ORI        r36, r34, -2147483648\n"
    "   64: SET_ALIAS  a4, r36\n"
    "   65: LABEL      L11\n"
    "   66: ANDI       r37, r5, 16\n"
    "   67: GOTO_IF_NZ r37, L3\n"
    "   68: ORI        r38, r7, 2139095040\n"
    "   69: BITCAST    r39, r38\n"
    "   70: SET_ALIAS  a5, r39\n"
    "   71: LOAD_IMM   r40, 5\n"
    "   72: LOAD_IMM   r41, 9\n"
    "   73: SELECT     r42, r41, r40, r7\n"
    "   74: GET_ALIAS  r43, a4\n"
    "   75: BFINS      r44, r43, r42, 12, 7\n"
    "   76: SET_ALIAS  a4, r44\n"
    "   77: GOTO       L2\n"
    "   78: LABEL      L10\n"
    "   79: SLTUI      r45, r8, 2097152\n"
    "   80: GOTO_IF_Z  r45, L12\n"
    "   81: ORI        r46, r7, 2139095039\n"
    "   82: BITCAST    r47, r46\n"
    "   83: SET_ALIAS  a5, r47\n"
    "   84: GET_ALIAS  r48, a4\n"
    "   85: NOT        r49, r48\n"
    "   86: ORI        r50, r48, 268435456\n"
    "   87: ANDI       r51, r49, 268435456\n"
    "   88: SET_ALIAS  a4, r50\n"
    "   89: GOTO_IF_Z  r51, L13\n"
    "   90: ORI        r52, r50, -2147483648\n"
    "   91: SET_ALIAS  a4, r52\n"
    "   92: LABEL      L13\n"
    "   93: LOAD_IMM   r53, 36\n"
    "   94: LOAD_IMM   r54, 40\n"
    "   95: SELECT     r55, r54, r53, r7\n"
    "   96: GET_ALIAS  r56, a4\n"
    "   97: BFINS      r57, r56, r55, 12, 7\n"
    "   98: SET_ALIAS  a4, r57\n"
    "   99: GOTO       L2\n"
    "  100: LABEL      L12\n"
    "  101: SLLI       r58, r8, 1\n"
    "  102: SET_ALIAS  a7, r58\n"
    "  103: ANDI       r59, r58, 8388608\n"
    "  104: GOTO_IF_NZ r59, L14\n"
    "  105: LOAD_IMM   r60, -1\n"
    "  106: SET_ALIAS  a6, r60\n"
    "  107: SLLI       r61, r58, 1\n"
    "  108: SET_ALIAS  a7, r61\n"
    "  109: LABEL      L14\n"
    "  110: GET_ALIAS  r62, a7\n"
    "  111: ANDI       r63, r62, 8388607\n"
    "  112: SET_ALIAS  a7, r63\n"
    "  113: LABEL      L6\n"
    "  114: LOAD       r64, 1000(r1)\n"
    "  115: GET_ALIAS  r65, a7\n"
    "  116: SRLI       r66, r65, 18\n"
    "  117: SLLI       r67, r66, 2\n"
    "  118: LOAD_IMM   r68, 253\n"
    "  119: GET_ALIAS  r69, a6\n"
    "  120: SUB        r70, r68, r69\n"
    "  121: SET_ALIAS  a6, r70\n"
    "  122: ZCAST      r71, r67\n"
    "  123: ADD        r72, r64, r71\n"
    "  124: LOAD_U16   r73, 2(r72)\n"
    "  125: LOAD_U16   r74, 0(r72)\n"
    "  126: BFEXT      r75, r65, 8, 10\n"
    "  127: MUL        r76, r75, r73\n"
    "  128: SLLI       r77, r74, 10\n"
    "  129: SUB        r78, r77, r76\n"
    "  130: ANDI       r79, r78, 1\n"
    "  131: SET_ALIAS  a8, r79\n"
    "  132: SRLI       r80, r78, 1\n"
    "  133: SET_ALIAS  a7, r80\n"
    "  134: GOTO_IF_Z  r70, L15\n"
    "  135: SLTSI      r81, r70, 0\n"
    "  136: GOTO_IF_NZ r81, L16\n"
    "  137: LABEL      L17\n"
    "  138: GET_ALIAS  r82, a7\n"
    "  139: OR         r83, r82, r7\n"
    "  140: GET_ALIAS  r84, a6\n"
    "  141: SLLI       r85, r84, 23\n"
    "  142: OR         r86, r83, r85\n"
    "  143: BITCAST    r87, r86\n"
    "  144: SET_ALIAS  a5, r87\n"
    "  145: BITCAST    r88, r87\n"
    "  146: SGTUI      r89, r88, 0\n"
    "  147: SRLI       r90, r88, 31\n"
    "  148: BFEXT      r94, r88, 23, 8\n"
    "  149: SEQI       r91, r94, 0\n"
    "  150: SEQI       r92, r94, 255\n"
    "  151: SLLI       r95, r88, 9\n"
    "  152: SEQI       r93, r95, 0\n"
    "  153: AND        r96, r91, r93\n"
    "  154: XORI       r97, r93, 1\n"
    "  155: AND        r98, r92, r97\n"
    "  156: AND        r99, r91, r89\n"
    "  157: OR         r100, r99, r98\n"
    "  158: OR         r101, r96, r98\n"
    "  159: XORI       r102, r101, 1\n"
    "  160: XORI       r103, r90, 1\n"
    "  161: AND        r104, r90, r102\n"
    "  162: AND        r105, r103, r102\n"
    "  163: SLLI       r106, r100, 4\n"
    "  164: SLLI       r107, r104, 3\n"
    "  165: SLLI       r108, r105, 2\n"
    "  166: SLLI       r109, r96, 1\n"
    "  167: OR         r110, r106, r107\n"
    "  168: OR         r111, r108, r109\n"
    "  169: OR         r112, r110, r92\n"
    "  170: OR         r113, r112, r111\n"
    "  171: GET_ALIAS  r114, a8\n"
    "  172: SLLI       r115, r114, 5\n"
    "  173: GOTO_IF_Z  r115, L18\n"
    "  174: GOTO_IF_NZ r85, L18\n"
    "  175: GET_ALIAS  r116, a4\n"
    "  176: NOT        r117, r116\n"
    "  177: ORI        r118, r116, 134217728\n"
    "  178: ANDI       r119, r117, 134217728\n"
    "  179: SET_ALIAS  a4, r118\n"
    "  180: GOTO_IF_Z  r119, L19\n"
    "  181: ORI        r120, r118, -2147483648\n"
    "  182: SET_ALIAS  a4, r120\n"
    "  183: LABEL      L19\n"
    "  184: LABEL      L18\n"
    "  185: OR         r121, r115, r113\n"
    "  186: GET_ALIAS  r122, a4\n"
    "  187: BFINS      r123, r122, r121, 12, 7\n"
    "  188: SET_ALIAS  a4, r123\n"
    "  189: GOTO       L2\n"
    "  190: LABEL      L16\n"
    "  191: LOAD_IMM   r124, 0\n"
    "  192: SET_ALIAS  a6, r124\n"
    "  193: GET_ALIAS  r125, a7\n"
    "  194: GET_ALIAS  r126, a8\n"
    "  195: ANDI       r127, r125, 3\n"
    "  196: SGTUI      r128, r127, 0\n"
    "  197: OR         r129, r126, r128\n"
    "  198: SET_ALIAS  a8, r129\n"
    "  199: ORI        r130, r125, 8388608\n"
    "  200: SRLI       r131, r130, 2\n"
    "  201: SET_ALIAS  a7, r131\n"
    "  202: GOTO       L17\n"
    "  203: LABEL      L15\n"
    "  204: GET_ALIAS  r132, a7\n"
    "  205: GET_ALIAS  r133, a8\n"
    "  206: ANDI       r134, r132, 1\n"
    "  207: OR         r135, r133, r134\n"
    "  208: SET_ALIAS  a8, r135\n"
    "  209: ORI        r136, r132, 8388608\n"
    "  210: SRLI       r137, r136, 1\n"
    "  211: SET_ALIAS  a7, r137\n"
    "  212: GOTO       L17\n"
    "  213: LABEL      L3\n"
    "  214: GET_ALIAS  r138, a4\n"
    "  215: BFEXT      r139, r138, 12, 7\n"
    "  216: ANDI       r140, r139, 31\n"
    "  217: GET_ALIAS  r141, a4\n"
    "  218: BFINS      r142, r141, r139, 12, 7\n"
    "  219: SET_ALIAS  a4, r142\n"
    "  220: GOTO       L1\n"
    "  221: LABEL      L2\n"
    "  222: GET_ALIAS  r143, a5\n"
    "  223: FCVT       r144, r143\n"
    "  224: STORE      408(r1), r144\n"
    "  225: SET_ALIAS  a2, r144\n"
    "  226: LABEL      L1\n"
    "  227: LOAD_IMM   r145, 4\n"
    "  228: SET_ALIAS  a1, r145\n"
    "  229: RETURN\n"
    "\n"
    "Alias 1: int32 @ 956(r1)\n"
    "Alias 2: float64 @ 400(r1)\n"
    "Alias 3: float64 @ 416(r1)\n"
    "Alias 4: int32 @ 944(r1)\n"
    "Alias 5: float32, no bound storage\n"
    "Alias 6: int32, no bound storage\n"
    "Alias 7: int32, no bound storage\n"
    "Alias 8: int32, no bound storage\n"
    "\n"
    "Block 0: <none> --> [0,11] --> 1,11\n"
    "Block 1: 0 --> [12,13] --> 2,3\n"
    "Block 2: 1 --> [14,14] --> 23\n"
    "Block 3: 1 --> [15,16] --> 4,5\n"
    "Block 4: 3 --> [17,25] --> 34\n"
    "Block 5: 3 --> [26,28] --> 6,7\n"
    "Block 6: 5 --> [29,34] --> 34\n"
    "Block 7: 5 --> [35,41] --> 8,9\n"
    "Block 8: 7 --> [42,43] --> 9\n"
    "Block 9: 8,7 --> [44,46] --> 10,33\n"
    "Block 10: 9 --> [47,54] --> 34\n"
    "Block 11: 0 --> [55,56] --> 12,16\n"
    "Block 12: 11 --> [57,62] --> 13,14\n"
    "Block 13: 12 --> [63,64] --> 14\n"
    "Block 14: 13,12 --> [65,67] --> 15,33\n"
    "Block 15: 14 --> [68,77] --> 34\n"
    "Block 16: 11 --> [78,80] --> 17,20\n"
    "Block 17: 16 --> [81,89] --> 18,19\n"
    "Block 18: 17 --> [90,91] --> 19\n"
    "Block 19: 18,17 --> [92,99] --> 34\n"
    "Block 20: 16 --> [100,104] --> 21,22\n"
    "Block 21: 20 --> [105,108] --> 22\n"
    "Block 22: 21,20 --> [109,112] --> 23\n"
    "Block 23: 22,2 --> [113,134] --> 24,32\n"
    "Block 24: 23 --> [135,136] --> 25,31\n"
    "Block 25: 24,31,32 --> [137,173] --> 26,30\n"
    "Block 26: 25 --> [174,174] --> 27,30\n"
    "Block 27: 26 --> [175,180] --> 28,29\n"
    "Block 28: 27 --> [181,182] --> 29\n"
    "Block 29: 28,27 --> [183,183] --> 30\n"
    "Block 30: 29,25,26 --> [184,189] --> 34\n"
    "Block 31: 24 --> [190,202] --> 25\n"
    "Block 32: 23 --> [203,212] --> 25\n"
    "Block 33: 9,14 --> [213,220] --> 35\n"
    "Block 34: 4,6,10,15,19,30 --> [221,225] --> 35\n"
    "Block 35: 34,33 --> [226,229] --> <none>\n"
    ;

#include "tests/rtl-disasm-test.i"
